from pwn import *

def choose_quest(db, idxs):
    idx = 0
    rmin = 0
    for i in range(2, len(db[0])):
        if i in idxs:
            continue
        r = 0
        for el in db:
            if el[i]:
                r+=1
        r = abs(r - len(db)//2)
        if idx==0 or r < rmin:
            rmin = r
            idx = i

    return idx 

def clean(l):
    prop = []
    val = []
    b = []
    for i in range(len(l)):
        if ':' in l[i]:
            p,v = l[i].split(' : ')
            
            p = p[p.find('>') + 1:]            
            if p[0] == ' ':
                p = p[1:]
            if p[0] == ' ':
                p = p[1:]
            b.append(p)
            prop.append(b)
            b=[]

            if i>2:
                val.append(v == 'Oui')
            else: 
                val.append(v)
        else:
            p = l[i][l[i].find('>') + 1:]            
            if p[0] == ' ':
                p = p[1:]
            b.append(p)

    return prop, val




target = remote("challs2.hackademint.org", 13407)

target.recvline()
target.sendline('2')
target.recvline()
target.sendline('')

def tick():
    try:
        print(target.recvuntil("###########################################################################\n").decode())
    except EOFError:
        target.interactive()

    db = target.recvuntil("Question")
    db = db.decode()
    db = db.split("###########################################################################\n")
    for i in range(len(db)):
        db[i] = db[i].split('\n')[:-2]

    prop,_ = clean(db[0]) 
    for i in range(len(db)):
        _,db[i] = clean(db[i])

    myst = ['', '']
    q = target.recvuntil("Choix: ").decode()
    q = q.split('\n')[4:-1]
    print(q)
    idxs = []
    for i in range(1,min(len(q), 15)):
        idx = choose_quest(db, idxs)
        idxs.append(idx)
        print(idx)
        print(q[idx-1])
        target.sendline(str(idx-1))
        r = target.recvline().decode()
        r = (r[-4:-1] == 'Oui')
        print(r)
        tdb = db
        db = []
        for el in tdb:
            if (bool(el[idx]) == r):
                db.append(el)

        print(len(tdb))
        print(len(db))
        
        target.recvuntil("Choix: ")

    print(db)
    
    target.sendline(str(len(q)))
    target.recvuntil('? ')
    guess = db[0][0]+' '+db[0][1]
    print("guess: "+guess)
    target.sendline(guess.encode())
    print(target.recvline().decode())


for i in range(100):
    print(i+1)
    tick()
target.interactive()
#print(target.recvuntil("###########################################################################\n").decode())


#db = []
#for i in range(99):
#    s = target.recvuntil("###########################################################################\n")
#    db.append(s.split(b'\n')[:-3])
#
#db.append(target.recvuntil("Question 0/15")[:-15].split(b'\n'))
#
#print(len(db))
#print(db[-1])
#



#target.interactive()
